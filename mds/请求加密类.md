```java
package com.immomo.momoenc;

import android.text.TextUtils;
import com.cosmos.mdlog.MDLog;
import com.immomo.mmutil.m;
import com.immomo.momo.util.jni.Coded;
import com.immomo.momoenc.d;
import com.immomo.momoenc.exception.AesEncodeFaildException;
import com.immomo.momoenc.exception.EmptyEncKeyException;
import java.io.BufferedReader;
import java.io.ByteArrayInputStream;
import java.io.Closeable;
import java.io.InputStreamReader;
import java.net.URI;
import java.nio.charset.Charset;
import java.util.HashMap;
import java.util.Map;
import java.util.zip.GZIPInputStream;
import org.json.JSONException;
import org.json.JSONObject;

/* loaded from: classes11-dex2jar.jar:com/immomo/momoenc/e.class */
public class e {

    /* renamed from: a */
    static final boolean f75942a = !e.class.desiredAssertionStatus();
    private String e;
    private volatile boolean g;
    private volatile boolean h;
    private volatile int i;
    private Map<String, String> j;
    private Map<String, String> k;
    private String m;
    private String n;
    private boolean o;

    /* renamed from: b */
    private String f75943b = "f14dd39f";

    /* renamed from: c */
    private int f75944c = 1;

    /* renamed from: d */
    private String f75945d = null;
    private boolean f = false;
    private byte[] l = null;

    public e(String str, int i) throws Exception {
        boolean z = true;
        this.m = str;
        this.o = (f.f75947b == null || !f.f75947b.a(this.m)) ? false : z;
        this.n = URI.create(str).getHost();
        this.i = i;
        this.g = f.a().a(str);
        e();
        f();
    }

    private static String a(byte[] bArr) {
        ByteArrayInputStream byteArrayInputStream;
        GZIPInputStream gZIPInputStream;
        ByteArrayInputStream byteArrayInputStream2;
        BufferedReader bufferedReader;
        Throwable th;
        ByteArrayInputStream byteArrayInputStream3;
        InputStreamReader inputStreamReader;
        InputStreamReader inputStreamReader2;
        Exception e;
        BufferedReader bufferedReader2;
        GZIPInputStream gZIPInputStream2;
        BufferedReader bufferedReader3;
        InputStreamReader inputStreamReader3;
        ByteArrayInputStream byteArrayInputStream4;
        BufferedReader bufferedReader4;
        try {
            byteArrayInputStream = new ByteArrayInputStream(bArr);
        } catch (Exception e2) {
            e = e2;
            gZIPInputStream = null;
            byteArrayInputStream2 = null;
        } catch (Throwable th2) {
            th = th2;
            byteArrayInputStream = null;
        }
        try {
            gZIPInputStream = new GZIPInputStream(byteArrayInputStream);
            try {
                inputStreamReader2 = new InputStreamReader(gZIPInputStream, "UTF-8");
            } catch (Exception e3) {
                byteArrayInputStream2 = byteArrayInputStream;
                e = e3;
                inputStreamReader2 = null;
                e = e;
                bufferedReader2 = null;
                byteArrayInputStream4 = byteArrayInputStream2;
                inputStreamReader3 = inputStreamReader2;
                bufferedReader3 = bufferedReader2;
                gZIPInputStream2 = gZIPInputStream;
                MDLog.printErrStackTrace("momoenc", e);
                com.immomo.mmutil.f.a(bufferedReader2);
                com.immomo.mmutil.f.a(inputStreamReader2);
                com.immomo.mmutil.f.a((Closeable) gZIPInputStream);
                com.immomo.mmutil.f.a((Closeable) byteArrayInputStream2);
                return null;
            } catch (Throwable th3) {
                th = th3;
                bufferedReader = null;
                byteArrayInputStream3 = byteArrayInputStream;
                inputStreamReader = null;
            }
            try {
                bufferedReader4 = new BufferedReader(inputStreamReader2);
                byteArrayInputStream4 = byteArrayInputStream;
                inputStreamReader3 = inputStreamReader2;
                bufferedReader3 = bufferedReader4;
                gZIPInputStream2 = gZIPInputStream;
            } catch (Exception e4) {
                e = e4;
                byteArrayInputStream2 = byteArrayInputStream;
                bufferedReader2 = null;
            } catch (Throwable th4) {
                th = th4;
                byteArrayInputStream3 = byteArrayInputStream;
                inputStreamReader = inputStreamReader2;
                bufferedReader = null;
                com.immomo.mmutil.f.a(bufferedReader);
                com.immomo.mmutil.f.a(inputStreamReader);
                com.immomo.mmutil.f.a((Closeable) gZIPInputStream);
                com.immomo.mmutil.f.a((Closeable) byteArrayInputStream3);
                throw th;
            }
        } catch (Exception e5) {
            byteArrayInputStream2 = byteArrayInputStream;
            e = e5;
            gZIPInputStream = null;
        } catch (Throwable th5) {
            th = th5;
            bufferedReader = null;
            th = th;
            byteArrayInputStream3 = byteArrayInputStream;
            inputStreamReader = null;
            gZIPInputStream = null;
            com.immomo.mmutil.f.a(bufferedReader);
            com.immomo.mmutil.f.a(inputStreamReader);
            com.immomo.mmutil.f.a((Closeable) gZIPInputStream);
            com.immomo.mmutil.f.a((Closeable) byteArrayInputStream3);
            throw th;
        }
        try {
            try {
                StringBuilder sb = new StringBuilder();
                while (true) {
                    String readLine = bufferedReader4.readLine();
                    if (readLine == null) {
                        String sb2 = sb.toString();
                        com.immomo.mmutil.f.a(bufferedReader4);
                        com.immomo.mmutil.f.a(inputStreamReader2);
                        com.immomo.mmutil.f.a((Closeable) gZIPInputStream);
                        com.immomo.mmutil.f.a((Closeable) byteArrayInputStream);
                        return sb2;
                    }
                    sb.append(readLine);
                }
            } catch (Throwable th6) {
                gZIPInputStream = gZIPInputStream2;
                bufferedReader = bufferedReader3;
                inputStreamReader = inputStreamReader3;
                byteArrayInputStream3 = byteArrayInputStream4;
                th = th6;
                com.immomo.mmutil.f.a(bufferedReader);
                com.immomo.mmutil.f.a(inputStreamReader);
                com.immomo.mmutil.f.a((Closeable) gZIPInputStream);
                com.immomo.mmutil.f.a((Closeable) byteArrayInputStream3);
                throw th;
            }
        } catch (Exception e6) {
            byteArrayInputStream2 = byteArrayInputStream;
            bufferedReader2 = bufferedReader4;
            e = e6;
            byteArrayInputStream4 = byteArrayInputStream2;
            inputStreamReader3 = inputStreamReader2;
            bufferedReader3 = bufferedReader2;
            gZIPInputStream2 = gZIPInputStream;
            MDLog.printErrStackTrace("momoenc", e);
            com.immomo.mmutil.f.a(bufferedReader2);
            com.immomo.mmutil.f.a(inputStreamReader2);
            com.immomo.mmutil.f.a((Closeable) gZIPInputStream);
            com.immomo.mmutil.f.a((Closeable) byteArrayInputStream2);
            return null;
        }
    }

    private String a(byte[] bArr, Map<String, String> map, String str) {
        if (m.e((CharSequence) str)) {
            return "";
        }
        byte[] bytes = str.getBytes();
        if (bytes.length < 8) {
            return "";
        }
        byte[] bytes2 = com.immomo.momoenc.c.c.a(map) ? f.a().c().getBytes(Charset.forName("UTF-8")) : "".getBytes(Charset.forName("UTF-8"));
        if (bArr == null) {
            return bytes2.length > 0 ? Coded.getInstance().sign(bytes2, bytes) : "";
        }
        try {
            byte[] bArr2 = new byte[bArr.length + bytes2.length];
            System.arraycopy(bytes2, 0, bArr2, 0, bytes2.length);
            System.arraycopy(bArr, 0, bArr2, bytes2.length, bArr.length);
            return Coded.getInstance().sign(bArr2, bytes);
        } catch (Exception e) {
            return "";
        }
    }

    private void a(String str, String str2) {
        a(str, (TextUtils.isEmpty(str) || !h()) ? null : str2.getBytes());
    }

    private boolean a(String str, byte[] bArr) {
        if (!this.g || this.i == 1) {
            return false;
        }
        if (!TextUtils.isEmpty(this.e) && this.e.equals(str)) {
            return true;
        }
        if (!TextUtils.isEmpty(str)) {
            String d2 = f.a().d();
            String str2 = d2;
            if (h()) {
                try {
                    str2 = new JSONObject(new String(bArr)).optString("momoid");
                } catch (JSONException e) {
                    MDLog.printErrStackTrace("momoenc", e);
                    str2 = d2;
                }
            }
            String str3 = str2;
            if (m.e((CharSequence) str2)) {
                str3 = d.a().e();
            }
            if (TextUtils.isEmpty(str3)) {
                return false;
            }
            String a2 = com.immomo.momoenc.c.b.a(str3 + f.a().a() + com.alipay.sdk.m.x.d.u);
            String substring = str.substring(0, 8);
            if (!TextUtils.isEmpty(a2) && substring.equalsIgnoreCase(a2.substring(0, 8))) {
                d.a().a(this.n, str);
                return true;
            }
        }
        d.a().a(this.n, "");
        a.c(this.n);
        b.d();
        return false;
    }

    public static void d() {
        if (f.b()) {
            c cVar = new c();
            b.a();
            d.a().c();
            cVar.a();
            d.a aVar = new d.a();
            aVar.f75940c = cVar.d();
            aVar.f75938a = cVar.b();
            aVar.f75939b = cVar.e();
            aVar.f75941d = cVar.a(aVar.f75939b);
            aVar.e = com.immomo.momoenc.c.d.a();
            aVar.f = cVar.c();
            aVar.g = true;
            d.a().j();
            d.a().a(aVar);
            try {
                if (!TextUtils.isEmpty(aVar.f75938a)) {
                    byte[] b2 = com.immomo.mmutil.a.b(aVar.f75938a.getBytes());
                    byte[] bytes = f.a().g().getBytes();
                    byte[] bArr = new byte[Coded.getInstance().computeOutputLength(b2.length, 1)];
                    int aesEncode = Coded.getInstance().aesEncode(b2, b2.length, bytes, bytes.length, bArr);
                    byte[] bArr2 = new byte[aesEncode];
                    System.arraycopy(bArr, 0, bArr2, 0, aesEncode);
                    d.a().b(com.immomo.mmutil.a.a(bArr2));
                    d.a().d(aVar.f + "");
                }
            } catch (Exception e) {
                MDLog.printErrStackTrace("momoenc", e);
            }
            String d2 = cVar.d();
            if (m.e((CharSequence) d2)) {
                return;
            }
            d.a().c(d2);
        }
    }

    private void e() {
        if (b.b()) {
            if (this.o) {
                f.a(this.m, "ExchangeKey excess maxFailCount Fallback", null);
                return;
            }
            return;
        }
        if (a.a(this.n)) {
            if (this.o) {
                f.a(this.m, "Enc or Dec excess maxFailCount Fallback", null);
                return;
            }
            return;
        }
        if (f.b()) {
            String a2 = d.a().a(this.n);
            this.e = a2;
            if (this.o && !TextUtils.isEmpty(a2)) {
                f.a(this.m, "PToken:" + this.e + " Fallback", null);
            }
            if (this.o) {
                f.a(this.m, "encType:" + this.i + " online:" + f.a().b() + " isEncHost:" + this.g, null);
            }
            boolean z = true;
            if (h() && TextUtils.isEmpty(this.e)) {
                this.h = true;
                return;
            }
            if (!this.g || !TextUtils.isEmpty(this.e) || !f.a().b() || this.i != 0) {
                z = false;
            }
            this.h = z;
        }
    }

    private void f() throws Exception {
        if (this.h) {
            b.a(this.m);
        }
        d.a b2 = d.a().b();
        if (b2 != null) {
            if (TextUtils.isEmpty(b2.f75940c)) {
                this.f75943b = "f14dd39f";
            } else {
                this.f75943b = b2.f75940c;
            }
            this.f75945d = b2.f75941d;
            this.f75944c = b2.e;
            this.f = b2.g;
        }
        if (this.o) {
            f.a(this.m, "encKey:" + this.f75945d, null);
        }
        if (!this.h || this.f) {
            return;
        }
        if (this.o) {
            f.a(this.m, "don't have ChangeKey, exchangeKeySync", null);
        }
        b.a(i(), 1, this.m);
        throw new EmptyEncKeyException();
    }

    private void g() {
        this.k.put("X-KV", this.f75943b);
        this.k.put("X-LV", this.f75944c + "");
        if (!TextUtils.isEmpty(this.e)) {
            this.k.put("X-PTOKEN", this.e);
            a.c(this.n);
        } else {
            if (b.b() || a.a(this.n)) {
                this.k.put("X-PTOKEN", j());
                a.c(this.n);
            }
        }
    }

    private boolean h() {
        return 2 == this.i || 3 == this.i;
    }

    private String i() {
        return this.f75943b;
    }

    private String j() {
        String str;
        String d2 = f.a().d();
        String str2 = d2;
        if (m.e((CharSequence) d2)) {
            str2 = d.a().e();
        }
        if (TextUtils.isEmpty(str2)) {
            str = "";
        } else {
            str = str2 + f.a().a() + com.alipay.sdk.m.x.d.u;
        }
        if (TextUtils.isEmpty(str)) {
            return "";
        }
        return com.immomo.momoenc.c.b.a(str).substring(0, 8) + f.a().f();
    }

    /* JADX WARN: Code restructure failed: missing block: B:17:0x00b3, code lost:
    
        if (r10.g != false) goto L217;
     */
    /* JADX WARN: Failed to find 'out' block for switch in B:12:0x0076. Please report as an issue. */
    /*
        Code decompiled incorrectly, please refer to instructions dump.
        To view partially-correct code enable 'Show inconsistent code' option in preferences
    */
    public java.lang.String a(com.immomo.momoenc.g r11) throws java.lang.Exception {
        /*
            Method dump skipped, instructions count: 724
            To view this dump change 'Code comments level' option to 'DEBUG'
        */
        throw new UnsupportedOperationException("Method not decompiled: com.immomo.momoenc.e.a(com.immomo.momoenc.g):java.lang.String");
    }

    public Map<String, String> a() {
        return this.j;
    }

    public void a(Map<String, String> map, Map<String, String> map2) {
        this.j = map;
        this.k = map2;
        if (map2 == null) {
            this.k = new HashMap();
        }
        if (this.j == null) {
            this.j = new HashMap();
        }
    }

    public Map<String, String> b() {
        return this.k;
    }

    public void c() throws Exception {
        String str;
        if (f.b()) {
            g();
            if (this.h) {
                Map<String, String> map = this.j;
                byte[] bArr = null;
                if (map == null || map.isEmpty()) {
                    str = null;
                } else {
                    JSONObject jSONObject = new JSONObject();
                    for (String str2 : this.j.keySet()) {
                        try {
                            jSONObject.put(str2, this.j.get(str2));
                        } catch (Exception e) {
                            MDLog.printErrStackTrace("momoenc", e);
                        }
                    }
                    String jSONObject2 = jSONObject.toString();
                    String str3 = this.f75945d;
                    try {
                        byte[] bytes = jSONObject2.getBytes();
                        byte[] bytes2 = str3.getBytes();
                        byte[] bArr2 = new byte[Coded.getInstance().computeOutputLength(bytes.length, 1)];
                        int aesEncode = Coded.getInstance().aesEncode(bytes, bytes.length, bytes2, bytes2.length, bArr2);
                        bArr = new byte[aesEncode];
                        System.arraycopy(bArr2, 0, bArr, 0, aesEncode);
                        str = com.immomo.mmutil.a.a(bArr);
                    } catch (Exception e2) {
                        a.b(this.n);
                        MDLog.printErrStackTrace("momoenc", e2);
                        if (this.o) {
                            f.a(this.m, "encode failed", e2);
                        }
                        throw new AesEncodeFaildException();
                    }
                }
                if (!f75942a && this.j == null) {
                    throw new AssertionError();
                }
                this.j.clear();
                if (str != null) {
                    this.j.put("mzip", str);
                }
                Map<String, String> map2 = this.k;
                map2.put("X-SIGN", a(bArr, map2, this.f75945d));
            }
            if (h()) {
                String e3 = d.a().e();
                this.j.put("ck", d.a().f());
                this.j.put("code_version", d.a().g());
                this.j.put("map_id", e3);
                this.j.put("X-KV", d.a().h());
            }
        }
    }
}
```